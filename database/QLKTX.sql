
CREATE DATABASE QUANLYKTX;
GO

USE QUANLYKTX;
GO

-- 1. BẢNG TÀI KHOẢN
CREATE TABLE TAIKHOAN (
    MATK CHAR(5) PRIMARY KEY,
    TENDANGNHAP NVARCHAR(50) UNIQUE NOT NULL,
    MATKHAU NVARCHAR(50) NOT NULL,
    VAITRO NVARCHAR(20) NOT NULL
);

-- 2. BẢNG SINH VIÊN
CREATE TABLE SINHVIEN (
    MASV CHAR(5) PRIMARY KEY,
    HOTEN NVARCHAR(100) NOT NULL,
    GIOITINH NVARCHAR(10),
    NGAYSINH DATE,
    LOP NVARCHAR(50),
    SDT NVARCHAR(15),
    DIACHI NVARCHAR(100),
    MATK CHAR(5) NOT NULL,
    FOREIGN KEY (MATK) REFERENCES TAIKHOAN(MATK)
);

-- 3. BẢNG NHÂN VIÊN
CREATE TABLE NHANVIEN (
    MANV CHAR(5) PRIMARY KEY,
    HOTEN NVARCHAR(100) NOT NULL,
    CHUCVU NVARCHAR(50),
    SDT NVARCHAR(15),
    MATK CHAR(5) NOT NULL,
    FOREIGN KEY (MATK) REFERENCES TAIKHOAN(MATK)
);

-- 4. BẢNG TÒA NHÀ
CREATE TABLE TOANHA (
    MATOA CHAR(5) PRIMARY KEY,
    TENTOA NVARCHAR(50) NOT NULL,
    DIADIEM NVARCHAR(100)
);

-- 5. BẢNG PHÒNG
CREATE TABLE PHONG (
    MAPHONG CHAR(5) PRIMARY KEY,
    TENPHONG NVARCHAR(50),
    SOGIUONG INT,
    TINHTRANG NVARCHAR(50),
    MATOA CHAR(5) NOT NULL,
    FOREIGN KEY (MATOA) REFERENCES TOANHA(MATOA)
);

-- 6. BẢNG HỢP ĐỒNG
CREATE TABLE HOPDONG (
    MAHD CHAR(5) PRIMARY KEY,
    MASV CHAR(5) NOT NULL,
    MAPHONG CHAR(5) NOT NULL,
    NGAYBATDAU DATE,
    NGAYKETTHUC DATE,
    TIENPHONG DECIMAL(10,2),
    FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV),
    FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG)
);

-- 7. BẢNG HÓA ĐƠN
CREATE TABLE HOADON (
    MAHDON CHAR(5) PRIMARY KEY,
    MAHD CHAR(5) NOT NULL,
    NGAYLAP DATE,
    TONGTIEN DECIMAL(10,2),
    FOREIGN KEY (MAHD) REFERENCES HOPDONG(MAHD)
);

-- 8. BẢNG THANH TOÁN
CREATE TABLE THANHTOAN (
    MATT CHAR(5) PRIMARY KEY,
    MAHDON CHAR(5) NOT NULL,
    NGAYTT DATE,
    SOTIENTT DECIMAL(10,2),
    HINHTHUCTT NVARCHAR(50),
    FOREIGN KEY (MAHDON) REFERENCES HOADON(MAHDON)
);

-- TAIKHOAN
INSERT INTO TAIKHOAN (MATK,TENDANGNHAP,MATKHAU,VAITRO)    
VALUES
('TK001', N'admin', N'123456', N'Quản trị'),
('TK002', N'sv01', N'123', N'Sinh viên'),
('TK003', N'sv02', N'123', N'Sinh viên'),
('TK004', N'nv01', N'123', N'Nhân viên'),
('TK005', N'nv02', N'123', N'Nhân viên');

-- SINHVIEN
INSERT INTO SINHVIEN (MASV, HOTEN, GIOITINH, NGAYSINH, LOP, SDT, DIACHI, MATK) 
VALUES
('SV001', N'Nguyễn Văn A', N'Nam', '2003-05-01', N'CNTT1', '0901111111', N'An Giang', 'TK002'),
('SV002', N'Lê Thị B', N'Nữ', '2004-06-15', N'KT1', '0902222222', N'An Giang', 'TK003');

-- NHÂNVIEN
INSERT INTO NHANVIEN (MANV, HOTEN, CHUCVU, SDT, MATK) 
VALUES
('NV001', N'Trần Văn C', N'Quản lý', '0903333333', 'TK004'),
('NV002', N'Phạm Thị D', N'Kế toán', '0904444444', 'TK005');

-- TOANHA
INSERT INTO TOANHA (MATOA, TENTOA, DIADIEM)
VALUES
('TN001', N'Tòa A', N'KTX Đại Học An Giang-An Giang'),
('TN002', N'Tòa B', N'KTX Đại Học An Giang-An Giang');

-- PHONG
INSERT INTO PHONG (MAPHONG, TENPHONG, SOGIUONG, TINHTRANG, MATOA)
VALUES
('P001', N'Phòng 101', 4, N'Còn trống', 'TN001'),
('P002', N'Phòng 102', 4, N'Đầy', 'TN001'),
('P003', N'Phòng 201', 6, N'Còn trống', 'TN002');

-- HOPDONG
INSERT INTO HOPDONG(MAHD, MASV, MAPHONG, NGAYBATDAU, NGAYKETTHUC, TIENPHONG)
VALUES
('HD001', 'SV001', 'P001', '2025-01-01', '2025-12-31', 1200000),
('HD002', 'SV002', 'P002', '2025-02-01', '2025-11-30', 1100000);

-- HOADON
INSERT INTO HOADON (MAHDON, MAHD, NGAYLAP,TONGTIEN)
VALUES
('HDON1', 'HD001', '2025-02-01', 1200000),
('HDON2', 'HD002', '2025-03-01', 1100000);

-- THANHTOAN
INSERT INTO THANHTOAN(MATT, MAHDON, NGAYTT, SOTIENTT, HINHTHUCTT)
VALUES
('TT001', 'HDON1', '2025-02-02', 1200000, N'Tiền mặt'),
('TT002', 'HDON2', '2025-03-03', 1100000, N'Chuyển khoản');
select * from PHONG


